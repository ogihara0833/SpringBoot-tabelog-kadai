<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <title>共通部品</title>

    <!-- ✅ meta部品 -->
    <div th:fragment="meta" th:remove="tag">
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
    </div>

    <!-- ✅ CSS/外部フォント -->
    <div th:fragment="styles" th:remove="tag">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500&display=swap" rel="stylesheet">
      <link th:href="@{/css/style.css}" rel="stylesheet">
    </div>
  </head>

  <body>

    <!-- ✅ ヘッダー -->
    <div th:fragment="header" th:remove="tag">
      <nav class="navbar navbar-expand-md navbar-light bg-white shadow-sm nagoyameshi-navbar">
        <div class="container nagoyameshi-container">
          <a class="navbar-brand" th:href="@{/}">
            <h1 class="logo-text m-0">NAGOYAMESHI</h1>
          </a>

          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">

              <!-- 未ログインユーザー -->
              <li class="nav-item" sec:authorize="isAnonymous()">
                <a class="nav-link" th:href="@{/login}">ログイン</a>
              </li>
              <li class="nav-item" sec:authorize="isAnonymous()">
                <a class="nav-link" th:href="@{/signup}">会員登録</a>
              </li>

			  <!-- ✅ 無料会員（FREE） -->
			  <li class="nav-item dropdown" sec:authorize="hasRole('FREE')">
			    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
   				  <span th:text="${#authentication.principal.user.name + ' 様'}"></span>
			      <span class="badge bg-secondary ms-2">一般会員</span>
			    </a>
			    <div class="dropdown-menu dropdown-menu-end">
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/user}">会員情報</a>
			      <a class="dropdown-item nagoyameshi-dropdown-item text-primary fw-bold" th:href="@{/membership/upgrade}">
			        N・MESHIメンバー登録（有料）
			      </a>
			      <div class="dropdown-divider"></div>
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/logout}"
			         onclick="event.preventDefault(); document.getElementById('logout-form').submit();">ログアウト</a>
			      <form id="logout-form" th:action="@{/logout}" method="post" class="d-none"></form>
			    </div>
			  </li>

			  <!-- ✅ N・MESHIメンバー（PREMIUM） -->
			  <li class="nav-item dropdown" sec:authorize="hasRole('PREMIUM')">
			    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
				  <span th:text="${#authentication.principal.user.name + ' 様'}"></span>
			      <span class="badge bg-primary ms-2">N・MESHIメンバー</span>
			    </a>
			    <div class="dropdown-menu dropdown-menu-end">
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/user}">会員情報</a>
				  <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/membership/portal}">クレジットカード情報を編集する</a>
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/reservations}">予約一覧</a>
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/favorites}">お気に入り一覧</a>
			      <a class="dropdown-item nagoyameshi-dropdown-item text-danger" th:href="@{/membership/cancel}">退会手続き</a>
			      <div class="dropdown-divider"></div>
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/logout}"
			         onclick="event.preventDefault(); document.getElementById('logout-form').submit();">ログアウト</a>
			      <form id="logout-form" th:action="@{/logout}" method="post" class="d-none"></form>
			    </div>
			  </li>

			  <!-- ✅ 管理者（ADMIN） -->
			  <li class="nav-item dropdown" sec:authorize="hasRole('ADMIN')">
			    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
			      管理者
			      <span class="badge bg-danger ms-2">管理者</span>
			    </a>
			    <div class="dropdown-menu dropdown-menu-end">
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/admin/restaurants}">店舗一覧</a>
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/admin/users}">会員一覧</a>
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/admin/categories}">カテゴリ一覧</a>
			      <div class="dropdown-divider"></div>
				  <a class="dropdown-item nagoyameshi-dropdown-item text-warning" th:href="@{/admin/restaurants/features}">注目店舗一覧</a>
			      <a class="dropdown-item nagoyameshi-dropdown-item" th:href="@{/logout}"
			         onclick="event.preventDefault(); document.getElementById('logout-form').submit();">ログアウト</a>
			      <form id="logout-form" th:action="@{/logout}" method="post" class="d-none"></form>
			    </div>
			  </li>

            </ul>
          </div>
        </div>
      </nav>
    </div>

    <!-- ✅ フッター -->
    <div th:fragment="footer" th:remove="tag">
      <footer class="text-center">
        <p class="text-muted small mb-0 py-3">&copy; NAGOYAMESHI All rights reserved.</p>
      </footer>
    </div>

    <!-- ✅ JSファイル読み込み -->
    <div th:fragment="scripts" th:remove="tag">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
      <script th:src="@{/js/preview.js}"></script>
	  <script th:src="@{/js/favorite.js}"></script>
    </div>

  </body>
</html>
